### 一次请求的完整过程

- 浏览器发起dns查询请求
  
  * 在广域网中，通信是基于IP地址的，通常下，用户输入的是一个网站，所以需要先获取到网址对应的IP地址，所以需要域名服务系统将域名转为IP地址；
  * 域名解析服务器是基于UDP服务协议的实现的一个程序，通过监听53端口来获取客户端的域名解析请求；
  * 通常，DNS请求的顺序为： 浏览器缓存-系统缓存（host文件）-路由器缓存-ISP DNS缓存- ；

- 域名服务器向客户端返回域名查询的结果，从而完成域名转换为IP地址
- 客户端向web服务器发送HTTP请求（熟悉一个HTTP请求头中的内容以及响应时的响应头的数据）

  * 当客户端向服务端发送请求时，需要进行三次握手，
  * 第一次握手：客户端发送SYN请求包，并进入SYN_SEND状态，等待客户端的确认；
  * 第二次握手：服务端收到SYN包后，需要确认客户的SYN，同时自己发送SYN+ACK请求包给客户端，自己进入SYN_RECV状态；
  * 第三次握手：客户端收到SYN+ACK包后，向服务端发送ACK包，此包发送完毕，客户端与服务端进入established状态，完成三次握手；

- 服务器给浏览器进行一个301永久重定向响应

  * 由于IP对应的服务器可能是代理服务器，所以需要将用户输入的地址重定向到最终的服务器，浏览器根据返回的重定向地址再次进行请求；

- 发送响应的数据给到客户端

  * 服务器根据客户端请求头，返回与请求头符合条件的响应结果，，此时，一次完整的HTTP请求完成；

- 浏览器根据返回的结构渲染
 
  * 在收到响应后，还要客户端继续发送请求向服务器，关于一些静态资源，比如图片或者视频，浏览器也会对静态资源进行缓存，而一些动态资源不会，会反复请求；
  * 整个过程结束后，浏览器关闭TCP的连接；

- TCP连接的四次挥手

  * 第一次挥手：客户端发起FIN请求报文给到服务器
  * 第二次挥手：服务端在收到FIN报文后先发送ACK给到客户端，代表已经收到了客户端的结束的请求，客户端在收到服务端的ACK报文后，进入FIN_WAIT状态，并继续等待服务端的FIN报文；
  * 第三次挥手：服务端在真正发送完数据后，发送FIN报文给到客户端，
  * 第四次挥手：客户端会发送ACK确认给到服务端，并进入TIME_WAIT状态，服务端在收到ACK后关闭连接，如果客户端在等待2MLS时间后，还是没有等待到客户端的回复，则代表服务端已经关闭，自身也会关闭；