# clickhouse高级部分

一、查看执行的计划

- 20.6.3版本后才能进行查询计划

- 基本的语法：

  - EXPLAIN 【AST】【SYNTAX】【PLAN】【PIPELINE】【setting = value】...
  - AST
  - SYNTAX
  - PLAN
  - PIPELINE

- 老版本查看执行计划

  将sql执行的日志重定位到日志文件，通过查看服务端的日志信息来了解查询计划信息

  --send_logs_level=trace指定

二、建表优化

- 时间字段的类型

  建表时能使用数值或者日期类型表示的字段就不要使用字符串

  虽然clickhouse底层将DateTime存储为时间戳Long类型，但不建议将直接存储为Long类型

- 空值存储类型

  Nullable字段类型总是会拖垮性能，

  - 因为存储一个Nullable列时会创建一个额外的文件来存储Null的标记，
  - 且Null列不能被索引，除非特殊的情况，
  - 应该直接使用字段默认值来表示空，或者自行指定一个在业务中没有意义的值来代表

- 分区与索引

  - 应该根据业务特点决定，不宜太大或者太小，一般按照天分区
  - 必须指定索引列，通过order by 来指定

- 表参数

- 写入与删除的优化

- 常见的配置

三、语法的优化规则

四、查询优化

五、数据一致性

六、物化视图

七、常见问题排查

