## flink

### 一、介绍

Apache Flink 是一个框架与分布式的处理引擎，用于对于无界与有界数据流进行状态转换。

### 二、flink快速上手

### 三、flink部署

- 从官方网站上下载关于flink的安装部署包，本次选择flink-1.13

### 四、flink运行时架

- 作业管理器

  控制一个应用程序执行的主进程，是flink集群中任务管理与调度的核心

  **jobmaster**

  - 是最核心的组件，负责处理单独的作业

  - 在作业提交时，此对象会接受到需要提交的应用，一般是由客户端提交来的，包括了jar包，数据流图以及作业图
  - 会把

### 五、

### 六、窗口与水位线

### 七、处理函数

- 基本处理函数

  - 处理函数的功能与使用
  - ProcessFunction解析
    - 抽象类继承AbstractRich

  - 处理函数的分类

- 按键分区处理函数

- 窗口处理函数

- 应用案例

### 十、容错机制

- ##### 检查点

  - 检查点保存

  - 检查点恢复状态

  - 检查点算法

    在数据中加一些特殊的标记，表示在这个数据处理之后则需要做检查点的保存

    标记是由jobmananger下发到源算子中的数据，打上标签，每个平行任务只要处理完毕这个数据后，就开始打快照，之后等所有平行任务处理完毕之后，会进行一次快照的拼接

  - 检查点的配置

    检查点存储备份间隔时间

    检查点存储位置设置：作业管理器的堆内存、文件系统（手动指定hdfs路径，常用的）

  - 保存点（Savepoint）

    区别在于会多一些元数据，是由用户触发的，有计划的备份

- ##### 状态一致性

  - 最多一次    at_most_once   有可能不处理，会出现数据的丢失
  - 至少一次    at_least_once    至少处理一次，有的事件可能被处理多次，检查点设置后可以保证
  - 精确一次    exactly_once      不但数据没有丢失，而且只被处理一次

- ##### 端到端的消费一致性

  内部保证--开启checkpoint
  
  source端  --可以重新设置数据的读取位置
  
  sink端-- 当故障恢复时，数据不会被重复写入外部系统中，需要具备幂等写入、事务写入
  
  ### 十一、Table ApI 与 SQL
  
  1. 一个简单的示例
  2. 基本API
     - 程序架构
     - 创建表环境
     - 创建表
     - 表的查询
     - 表与流的转换
  3. 流处理中的表
  
  ### 十二、flink cep 
  
  ##### 1.基本概念
  
    它是复杂事件处理的缩写，是flink用于处理复杂事件处理的库
  
  - 首先定义出一个匹配的规则
  - 将匹配的规则应用到输入的事件流中，检测是否满足复杂事件
  - 对检测到的复杂事件，得到结果进行输出
  
  ##### 2.模式（pattern）
  
  - 主要包括2个部分：
    1. 简单事件的特质
    2. 简单事件的组合关系
  
  ##### 3.应用场景
  
  用于实时数据流，比如风险控制、用户的画像、运维监控
  
  ##### 4.快速上手
  
  - 引入依赖
  - 场景如：用户如果连续登陆失败三次，则应该输出报警信息
  
  ##### 5.模式API
  
  - 个体模式：每个简单事件的匹配规则
  - 量词：指定循环的次数，分为单例模式与循环模式
    1. oneOrMore    匹配一次事件出现一次或者多次
    2. times  匹配事件发生的次数
    3. times(from,to)   指定匹配事件出现的次数范围，最小为from，最大为to
    4. greedy      只能用在循环模式之后尽可能多的匹配事件出现的次数
    5. optional    使得当前的匹配模式成为可选的，意味着可以满足这个匹配的条件，也可不匹配
  - 复杂条件
  - 
  
  
