### Redis三种集群模式

- 单节点模式

  - 最简单的模式，只有一个redis实例

- 主从模式

  - 主从模式工作原理：

  ​        slave从节点在服务启动后连接到主节点，会主动发送一个SYNC命令，master服务器在接受到会启用后台进程，收集所有用于修改数据的命令，把这个数据库的文件传送到从节点上，以完成一次的同步，slave在接受到数据库文件后会加载到内存中，之后，master会继续收集所有的修改命令，传送给salve节点，从而达到数据的同步；如果出现master和slave直接的断链，salve在启动后会自动重连master，连接成功后，一次完全同步也会执行；

  ​        2.8版本之后，使用psync来完成同步，分为全部与部分，全部复制就是之前的，在新创建一次连接中，会把内存中所有的内容全部复制，而部分复制是，在网络出现问题时，从节点连接主节点，不会把所有的数据发送，而是补发缺少的数据，主从之间会有心跳连接，会知道从节点什么时间挂掉；

  - 主从模式的优点 ：

  - 主从模式的缺点：

    1.主节点挂掉就不能提供服务，需要手动修改配置

    2.主节点的写能力与存储能力有限

- 哨兵模式

  - 哨兵模式可以解决主从复制的问题，当主节点出现问题时，由redis sentinel自动完成故障的发现与转移，实现了高可用


- 持久化方式

  - RDB---默认

    快照方式，当符合一定的条件时，redis会自动把内存中的数据存储在硬盘上，条件的构成参数有2个，分别为时间和改动键数的个数，即 save   900   1，代表了在900秒内至少有1个键值被更新了就会触发快照，可以有多个条件，之间的关系是或，只要有一个条件满足即可；

    实现快照的过程：

    Redis使用fork函数进行当前线程的复制，父进程负责继续进行处理客户端发来的请求，子进程负责把内存中的数据写入硬盘中的临时rdb文件，Redis在执行快照的过程中不会修改rdb文件，只有在快照结束后才会将旧的文件替换为新的，同时这个文件是经过压缩的二进制文件，便于文件的传输；

  - AOF

    默认的情况下，没有开启此持久化方式，可在redis.conf文件中 修改为  appendonly  yes

    在初次启动redis时，会逐个执行AOF文件中的命令并载入到内存中，载入的速度较RDB缓慢；

    开启后，每执行一条更改的命令都会写入硬盘中，一般会有以下的一些配置

    - appendfsync     always    每次都会执行
    - appendfsync     everysec    每秒执行一次
    - appendfsync     no         不主动进行同步，默认是30s一次

  - 总结

    一般是二者结合使用，结合具体的情景