### Redis线程模型原理

- Redis是单线程，自然线程安全
  - 采用多路I/O复用使得单个线程处理多个连接的请求；
  - 为什么不采用多线程？多线程处理可能遇到锁，并且线程的频繁切换回消耗CPU资源；
  - 单线程处理的优缺点？不采用多线程无法发挥多核的优势，但是可以通过单机开启多个Redis实例实现；
- 什么是多路复用I/O？
  - 多路是指多个socket连接，复用是指复用一个线程；
  - 网络IO是socket实现的，Server在某一个端口监听，客户端是通过IP+port来与服务器进行连接，成功连接后，socket中封装的inputstream与outputstream进行IO交互，针对每一个客户端，服务端都会创建一个新的线程专门处理；
  - 默认的情况下，网络IO是阻塞的，服务器线程在数据到来之前是处于阻塞的，数据到达后，会自动触发，所以一个线程只能处理一个IO事件；
  - 三种模式
    - poll（忙轮询）：死循环访问每一个流，如果有IO流就处理，但是效率不高，CPU空转；
    - select代理：可以观察多个流的IO事件，如果没有IO事件，进入阻塞模式，如果有一个或者多个IO事件就去处理，但是还是要轮询所有的流，这个才可以找出那个流需要处理；复杂度为n
    - epoll:会观察那个流发生了怎样的IO事件来通知处理线程，复杂度降低到了1
- Redis的快的原因;
  - 因为是纯内存操作，时间都消耗在IO，所以读取速度快；
  - Redis采用非阻塞式IO，IO多路复用，使用单线程来轮询描述符，把数据库的开关读写转化为事件，减少了线程切换时的上下文的切换；
  - 因为是单线程的模型，保证了每个操作的原子性；
  - Redis存储使用的数据结构，可以加快读取的速度；